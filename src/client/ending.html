<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Find the answer!</title>
    <link rel="stylesheet" href="./styles/ending.css">
</head>
<body>
    <div id="please">
        <p>안녕, 네가 이 게임을 끝내주길 바<br>래.</p>
    </div>
    
    <div id="kitty">
        <div id="choice">
        <p>이 게임을 끝내주겠니?</p>
            <div class="choiceBtn">
                <button id="yes" onclick="yes()">(확인)</button> <!-- 결과 화면 -->
                <button id="no" onclick="no()">(취소)</button> <!-- 갑툭튀 -->
            </div>
        </div>
        <img src="./assets/images/kitty-crying.png" alt="kitty" width="250">
    </div>
    <script src="./scripts/jumpscare.js"></script>
    <script>
        function yes(){
            const startTime = localStorage.getItem("startTime");
            const endTime = Date.now();

            if(startTime){
                const ms = endTime - startTime;
                const sec = Math.floor(ms / 1000);
                localStorage.setItem("totalPlayTime", sec);
            }
            window.location.href = 'result.html';
        }
        async function HorrorEndingBg(){
            try {
                const res = await fetch("/backgrounds/horrorEnding");
                const data = await res.json();
                // 배경을 적용할 div를 준비
                let bgDiv = document.getElementById("background");
                if(!bgDiv){
                    bgDiv = document.createElement("div");
                    bgDiv.id = "background";
                    Object.assign(bgDiv.style, {
                        position: "fixed", inset: 0, width: "100vw", height: "100vh",
                        zIndex: "-1", backgroundSize: "cover", backgroundPosition: "center"
                    });
                    document.body.appendChild(bgDiv);
                }
                bgDiv.style.backgroundImage = `url(${data.file_path})`;
            } catch (err) {
                console.error("배경 불러오기 실패", err);
            }
        }
       
        function no(){
            document.getElementById("please").remove();
            document.getElementById("kitty").remove();
            HorrorEndingBg();
            setTimeout(()=>{
                triggerJumpscare();
                setTimeout(()=>{
                    window.location.href="main.html";
                },1200);
            }, 2000);
        }
        
    </script>
</body>
</html>

<script>
window.addEventListener("DOMContentLoaded", () => {
  Sound.play("./assets/audios/ending.mp3", true, 0.6);
});
</script>